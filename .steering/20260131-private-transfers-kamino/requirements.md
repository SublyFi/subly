# 要件定義: プライベート定期送金 & プライベートKamino Deposit

## 概要

Privacy Cashを活用した以下の2つの機能を実装する:
1. **プライベート定期送金** - 送金先・金額を秘匿した定期的な自動送金
2. **プライベートKamino Deposit** - Privacy Cash残高をKaminoで運用し利回りを獲得

## 前提条件

- Privacy Cash deposit/withdrawは既に動作確認済み
- Kamino CPI統合は既に実装済み（オンチェーン側）
- フロントエンドではKamino SDKは未導入

---

## 機能1: プライベート定期送金

### ユーザーストーリー

```
ユーザーとして、
Privacy Cashの残高から定期的に自動送金を設定したい。
なぜなら、送金先・金額・タイミングをプライベートに保ちながら
定期的な支払い（サブスクリプション、給与等）を行いたいからだ。
```

### 要件

| ID | 要件 | 優先度 |
|----|------|--------|
| RT-01 | ユーザーはUI上で定期送金を設定できる（送金先、金額、間隔） | P0 |
| RT-02 | 送金先アドレスは暗号化されてオンチェーンに保存される | P0 |
| RT-03 | 設定された間隔で自動的に送金が実行される | P0 |
| RT-04 | 送金履歴をユーザーのみが確認できる | P1 |
| RT-05 | 定期送金をキャンセルできる | P0 |
| RT-06 | 残高不足時はスキップし、次回実行時に通知 | P1 |

### 技術要件

- Privacy Cash SDKを使用したプライベート送金
- オンチェーン状態とローカルストレージの同期
- 自動実行トリガー（Tuk Tuk / Clockwork代替）

---

## 機能2: プライベートKamino Deposit

### ユーザーストーリー

```
ユーザーとして、
Privacy Cashの残高をKaminoに預けて利回りを獲得したい。
なぜなら、プライバシーを保ちながら資産を運用したいからだ。
```

### 要件

| ID | 要件 | 優先度 |
|----|------|--------|
| KD-01 | ユーザーは手動でKaminoにデポジットできる | P0 |
| KD-02 | Kaminoからの利回り（APY）をリアルタイムで表示 | P0 |
| KD-03 | ユーザーはKaminoから引き出しできる | P0 |
| KD-04 | 獲得した利回りを確認できる | P1 |
| KD-05 | シールドプール経由でプライバシーを保護 | P0 |

### 技術要件

- `@kamino-finance/klend-sdk`を使用
- `KaminoMarket.load()` でマーケット情報取得
- `KaminoAction.buildDepositTxns()` でデポジットTx構築
- `KaminoAction.buildWithdrawTxns()` で引き出しTx構築
- `kaminoReserve.totalSupplyAPY()` でAPY取得

---

## 受け入れ条件

### プライベート定期送金
- [ ] UIで定期送金を設定できる
- [ ] 設定した間隔で自動送金が実行される
- [ ] 送金先はオンチェーンで暗号化されている
- [ ] キャンセル操作が正常に動作する

### プライベートKamino Deposit
- [ ] UIからKaminoへデポジットできる
- [ ] Kamino SDKを使用してAPYが正確に表示される
- [ ] UIからKaminoから引き出しできる
- [ ] プライバシーが保護されている（シールドプール経由）

---

## 制約事項

1. Kamino SDKはフロントエンドで使用（オンチェーン側はCPIを継続）
2. Privacy Cash SDKとの統合が必要
3. 自動実行にはTuk Tuk統合が必要（Phase 3で対応）

## 依存関係

- `@kamino-finance/klend-sdk` のインストールが必要
- Privacy Cash SDK（既存）
- Solana web3.js（既存）
