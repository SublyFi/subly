# 要求内容

## 概要

ユーザーダッシュボード（`apps/dashboard-user`）にVault機能（Protocol B）を統合し、プライベート残高管理、入出金、定期送金設定、決済履歴表示を実装する。

## 背景

現在のユーザーダッシュボードは、サブスクリプション管理（Protocol A: subly-membership）のみを実装している。PRD B4「ユーザーダッシュボード（Vault）」の要件を満たすため、Protocol B（subly-vault）の機能を統合する必要がある。

これにより、ユーザーは以下の完全なプライバシー保護付きサブスクリプション体験を得られる：
1. USDCをプライベートに入金
2. Kamino Lendingで自動運用（利回り生成）
3. 定期的にプライベート送金で事業者に支払い
4. 送金元・金額が秘匿された状態で決済

## 実装対象の機能

### 1. Vault概要画面（VaultOverview）
- プライベート残高の表示（本人のみ閲覧可能）
- 運用益の累計・現在の利回り（APY）表示
- 入金・出金へのナビゲーション

### 2. 入金機能（Deposit）
- Privacy Cash経由でUSDCをプライベートに入金
- 入金額の入力フォーム
- 入金処理のステータス表示
- 入金完了後の残高更新

### 3. 出金機能（Withdraw）
- Privacy Cash経由でプライベートに出金
- 出金額の入力フォーム
- 出金処理のステータス表示

### 4. 定期送金設定（ScheduledTransfers）
- 定期送金の一覧表示
- 新規定期送金の設定（事業者アドレス、金額、周期）
- 定期送金のキャンセル
- 次回実行日時の表示

### 5. 決済履歴（History）
- 入金・出金・定期送金の履歴表示
- 日時、金額、ステータスの表示
- 送金先は秘匿表示（ユーザー本人にのみ表示）

## 受け入れ条件

### Vault概要画面
- [ ] ユーザーはウォレット接続後、プライベート残高を確認できる
- [ ] 運用益（APY）と累計利回りが表示される
- [ ] 入金・出金ボタンから各機能に遷移できる

### 入金機能
- [ ] ユーザーは入金額を入力できる
- [ ] 入金処理中はローディング状態が表示される
- [ ] 入金完了後、残高が更新される
- [ ] エラー時は適切なエラーメッセージが表示される

### 出金機能
- [ ] ユーザーは出金額を入力できる
- [ ] 残高を超える出金はバリデーションで拒否される
- [ ] 出金処理中はローディング状態が表示される
- [ ] 出金完了後、残高が更新される

### 定期送金設定
- [ ] アクティブな定期送金の一覧が表示される
- [ ] 新規定期送金を設定できる（事業者アドレス、金額、周期）
- [ ] 定期送金をキャンセルできる
- [ ] 次回実行日時が表示される

### 決済履歴
- [ ] 入金・出金・定期送金の履歴が時系列で表示される
- [ ] 各履歴には日時、種類、金額、ステータスが含まれる
- [ ] ページネーションまたは無限スクロールで過去の履歴を閲覧できる

## 成功指標

- Vault機能の全画面がエラーなく表示される
- 入金から定期送金設定までの一連のフローが完了できる
- ビルドが成功し、型エラーがない

## スコープ外

以下はこのフェーズでは実装しません：

- Tuk Tuk自動化の完全統合（設定UIのみ実装、自動実行はモック）
- Kamino Lendingへの実際の預け入れ（APYはモック値）
- Privacy Cash Mainnetでの実トランザクション（Devnetまたはモック）
- バッチ証明補充フロー（将来フェーズ）
- 多言語対応

## 参照ドキュメント

- `docs/product-requirements.md` - プロダクト要求定義書（B4: ユーザーダッシュボード）
- `docs/functional-design.md` - 機能設計書（ユーザーダッシュボード画面遷移図・ワイヤフレーム）
- `docs/architecture.md` - アーキテクチャ設計書（Protocol B設計）
- `subly-mainnet/packages/vault-sdk/` - Vault SDK実装
